---
layout: post
title:  ssl-сертификат
date:   2019/05/20 15:00:00
tag:    ssl server
---

SAN.txt

====== SAN ======

[Источник](http://wiki.cacert.org/FAQ/subjectAltName)


1. Каталог my_cert
2. Берем [[/usr/share/ssl-cert/ssleay.cnf]] копируем и переименовываем my.conf

#
# SSLeay example configuration file.
#

RANDFILE = /dev/urandom

[ req ]

default_bits = 2048
default_keyfile = privkey.pem
distinguished_name = req_distinguished_name
prompt = no

policy = policy_anything

req_extensions = v3_req

## !!! без этого SAN не создает !!!

x509_extensions = v3_req

[ req_distinguished_name ]

commonName = @HostName@

[ v3_req ]

basicConstraints = CA:FALSE
##

3. дописываем

[ v3_req ]

...

keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names

[alt_names]

DNS.1 = my.ru
DNS.2 = www2.my.ru
DNS.3 = test.my.ru
DNS.4 = ub_test

и в

[ req_distinguished_name ]

добавляем что нужно

...

C=RU
ST=Russia
L=Omsk
O=My
OU=ITO
emailAddress=my@my.ru

...

4. Пишем скрипт

#!/bin/bash

name="my"
pass="1234"

# Создаем запрос

openssl req -new -x509 \
-days 365 \
-keyout ${name}.key \
-out ${name}.pem \
-config ${name}.conf \
-passout pass:${pass}

# копируем

##cp ${name}.key{,.orig}
cp ${name}.key ${name}.key.orig

# unlock key - разлочили, а то апач будет пароль требовать
openssl rsa -in ${name}.key.orig -out ${name}.key -passin pass:${pass}

# удаляем оригинальный залоченый
rm ${name}.key.orig

# test - проверяем (должно быть несколько
## DNS:ub_test2, DNS:*.*.ev.dev, DNS:ub_test,
## DNS:system.dev, IP Address:192.168.0.227)

openssl x509 -in omua.pem -noout -text

exit 0

5. Пишем скрипт для установки сертификатов

#!/bin/bash

name="my"

cp ${name}.pem /etc/ssl/certs/
cp ${name}.key /etc/ssl/private/
chown root:root /etc/ssl/private/${name}.key
chmod 0400 [[/etc/ssl/private/${name}.key]]

service apache2 reload

exit 0

!!!Все...

PS.
Раньше делал без SAN






